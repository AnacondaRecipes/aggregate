{% set version = "4.5.0" %}
{% set ver_maj_min = "4.5" %}

package:
  name: qtcreator
  version: {{ version }}

source:
  git_url: https://code.qt.io/qt-creator/qt-creator.git
  git_tag: origin/4.5
  patches:
    - 4.5/0001-macOS-Disable-app-bundle.patch
    # - 4.2/0001-macOS-Disable-app-bundle.patch
    # - 4.2/0002-Use-systemEnvironment-for-Start-and-Debug-External-A.patch
    # - 4.0/0001-Disable-app-build.patch                                               # [osx]
    # - 4.0/0002-Use-systemEnvironment-For-Start-and-Debug-External-Application.patch

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - {{ cdt('xorg-x11-proto-devel') }}  # [linux]
    - {{ cdt('libx11-devel') }}          # [linux]
    - {{ cdt('libxext-devel') }}         # [linux]
    - {{ cdt('libxrender-devel') }}      # [linux]
    - {{ cdt('mesa-libgl-devel') }}      # [linux]
    - {{ cdt('mesa-libegl-devel') }}     # [linux]
    - {{ cdt('mesa-dri-drivers') }}      # [linux]
    - {{ cdt('libxau-devel') }}          # [linux]
    - {{ cdt('alsa-lib-devel') }}        # [linux]
    - {{ cdt('gtk2-devel') }}            # [linux]
    - {{ cdt('gtkmm24-devel') }}         # [linux]
    - {{ cdt('libdrm-devel') }}          # [linux]
    - {{ cdt('libxcomposite-devel') }}   # [linux]
    - {{ cdt('libxcursor-devel') }}      # [linux]
    - {{ cdt('libxi-devel') }}           # [linux]
    - {{ cdt('libxrandr-devel') }}       # [linux]
    - {{ cdt('pciutils-devel') }}        # [linux]
    - {{ cdt('libxscrnsaver-devel') }}   # [linux]
    - {{ cdt('libxtst-devel') }}         # [linux]
    - {{ cdt('libselinux-devel') }}      # [linux]
    - {{ cdt('libxdamage') }}            # [linux]
    - {{ cdt('libxfixes') }}             # [linux]
    - {{ cdt('libxxf86vm') }}            # [linux]
    - jom                                # [win]
    - make                               # [not win]
  host:
    - llvmdev
    - clangdev
    - qt
    - libxcb                             # [linux]
  run:
    - cmake
    - vs2015_runtime                     # [win]

  # These are only necessary for the qtcreator executable itself.
  # It would be better if were possible to filter the application
  # of these using wildcards or regular expressions.
  rpaths:
    - lib
    - lib/qtcreator
  # This is necessary for calls to xcrun to make `.icns` files.
  script_env:        # [osx]
    - TMPDIR         # [osx]

outputs:

  - name: qbs
    script: install-qbs.sh
    requirements:
      build:
       - make                               # [not win]
      host:
       - qt

  - name: qtcreator
    script: install-qtcreator.sh
    requirements:
      build:
        - make                               # [not win]
      host:
        - {{ pin_subpackage('qbs', exact=True) }}
        - qt
      run:
        - {{ pin_subpackage('qbs', exact=True) }}
